(function(b,a){var c={smoketimeout:[],init:false,zindex:1000,i:0,bodyload:function(e){var d=a.createElement("div");d.setAttribute("id","smoke-out-"+e);d.className="smoke-base";d.style.zIndex=c.zindex;c.zindex++;a.body.appendChild(d);if(typeof FastClick!="undefined"){FastClick.attach(d)}},newdialog:function(){var d=new Date().getTime();d=Math.random(1,99)+d;if(!c.init){c.listen(b,"load",function(){c.bodyload(d)})}else{c.bodyload(d)}return d},forceload:function(){},build:function(m,k){c.i++;k.stack=c.i;m=m.replace(/\n/g,"<br />");m=m.replace(/\r/g,"<br />");var d="",g="OK",j="Cancel",l="",i="",h;if(k.type==="prompt"){d='<div class="dialog-prompt"><input id="dialog-input-'+k.newid+'" type="text" '+(k.params.value?'value="'+k.params.value+'"':"")+" /></div>"}if(k.params.ok){g=k.params.ok}if(k.params.cancel){j=k.params.cancel}if(k.params.classname){l=k.params.classname}if(k.type!=="signal"){i='<div class="dialog-buttons">';if(k.type==="alert"){i+='<button id="alert-ok-'+k.newid+'">'+g+"</button>"}else{if(k.type==="quiz"){if(k.params.button_1){i+='<button class="quiz-button" id="'+k.type+"-ok1-"+k.newid+'">'+k.params.button_1+"</button>"}if(k.params.button_2){i+='<button class="quiz-button" id="'+k.type+"-ok2-"+k.newid+'">'+k.params.button_2+"</button>"}if(k.params.button_3){i+='<button class="quiz-button" id="'+k.type+"-ok3-"+k.newid+'">'+k.params.button_3+"</button>"}if(k.params.button_cancel){i+='<button id="'+k.type+"-cancel-"+k.newid+'" class="cancel">'+k.params.button_cancel+"</button>"}}else{if(k.type==="prompt"||k.type==="confirm"){if(k.params.reverseButtons){i+='<button id="'+k.type+"-ok-"+k.newid+'">'+g+'</button><button id="'+k.type+"-cancel-"+k.newid+'" class="cancel">'+j+"</button>"}else{i+='<button id="'+k.type+"-cancel-"+k.newid+'" class="cancel">'+j+'</button><button id="'+k.type+"-ok-"+k.newid+'">'+g+"</button>"}}}}i+="</div>"}h='<div id="smoke-bg-'+k.newid+'" class="smokebg"></div><div class="dialog smoke '+l+'"><div class="dialog-inner">'+m+d+i+"</div></div>";if(!c.init){c.listen(b,"load",function(){c.finishbuild(m,k,h)})}else{c.finishbuild(m,k,h)}},finishbuild:function(i,h,g){var d=a.getElementById("smoke-out-"+h.newid);d.className="smoke-base smoke-visible  smoke-"+h.type;d.innerHTML=g;while(d.innerHTML===""){d.innerHTML=g}if(c.smoketimeout[h.newid]){clearTimeout(c.smoketimeout[h.newid])}c.listen(a.getElementById("smoke-bg-"+h.newid),"click",function(){c.destroy(h.type,h.newid);if(h.type==="prompt"||h.type==="confirm"||h.type==="quiz"){h.callback(false)}else{if(h.type==="alert"&&typeof h.callback!=="undefined"){h.callback()}}});switch(h.type){case"alert":c.finishbuildAlert(i,h,g);break;case"confirm":c.finishbuildConfirm(i,h,g);break;case"quiz":c.finishbuildQuiz(i,h,g);break;case"prompt":c.finishbuildPrompt(i,h,g);break;case"signal":c.finishbuildSignal(i,h,g);break;default:throw"Unknown type: "+h.type}},finishbuildAlert:function(h,g,d){c.listen(a.getElementById("alert-ok-"+g.newid),"click",function(){c.destroy(g.type,g.newid);if(typeof g.callback!=="undefined"){g.callback()}});a.onkeyup=function(f){if(!f){f=b.event}if(f.keyCode===13||f.keyCode===32||f.keyCode===27){c.destroy(g.type,g.newid);if(typeof g.callback!=="undefined"){g.callback()}}}},finishbuildConfirm:function(h,g,d){c.listen(a.getElementById("confirm-cancel-"+g.newid),"click",function(){c.destroy(g.type,g.newid);g.callback(false)});c.listen(a.getElementById("confirm-ok-"+g.newid),"click",function(){c.destroy(g.type,g.newid);g.callback(true)});a.onkeyup=function(f){if(!f){f=b.event}if(f.keyCode===13||f.keyCode===32){c.destroy(g.type,g.newid);g.callback(true)}else{if(f.keyCode===27){c.destroy(g.type,g.newid);g.callback(false)}}}},finishbuildQuiz:function(j,i,h){var g,d,k;c.listen(a.getElementById("quiz-cancel-"+i.newid),"click",function(){c.destroy(i.type,i.newid);i.callback(false)});if(g=a.getElementById("quiz-ok1-"+i.newid)){c.listen(g,"click",function(){c.destroy(i.type,i.newid);i.callback(g.innerHTML)})}if(d=a.getElementById("quiz-ok2-"+i.newid)){c.listen(d,"click",function(){c.destroy(i.type,i.newid);i.callback(d.innerHTML)})}if(k=a.getElementById("quiz-ok3-"+i.newid)){c.listen(k,"click",function(){c.destroy(i.type,i.newid);i.callback(k.innerHTML)})}a.onkeyup=function(f){if(!f){f=b.event}if(f.keyCode===27){c.destroy(i.type,i.newid);i.callback(false)}}},finishbuildPrompt:function(i,g,d){var h=a.getElementById("dialog-input-"+g.newid);setTimeout(function(){h.focus();h.select()},100);c.listen(a.getElementById("prompt-cancel-"+g.newid),"click",function(){c.destroy(g.type,g.newid);g.callback(false)});c.listen(a.getElementById("prompt-ok-"+g.newid),"click",function(){c.destroy(g.type,g.newid);g.callback(h.value)});a.onkeyup=function(f){if(!f){f=b.event}if(f.keyCode===13){c.destroy(g.type,g.newid);g.callback(h.value)}else{if(f.keyCode===27){c.destroy(g.type,g.newid);g.callback(false)}}}},finishbuildSignal:function(h,g,d){a.onkeyup=function(f){if(!f){f=b.event}if(f.keyCode===27){c.destroy(g.type,g.newid);if(typeof g.callback!=="undefined"){g.callback()}}};c.smoketimeout[g.newid]=setTimeout(function(){c.destroy(g.type,g.newid);if(typeof g.callback!=="undefined"){g.callback()}},g.timeout)},destroy:function(f,k){var g=a.getElementById("smoke-out-"+k);if(f!=="quiz"){var j=a.getElementById(f+"-ok-"+k)}var h=a.getElementById(f+"-cancel-"+k);g.className="smoke-base";if(j){c.stoplistening(j,"click",function(){});a.onkeyup=null}if(f==="quiz"){var d=a.getElementsByClassName("quiz-button");for(var e=0;e<d.length;e++){c.stoplistening(d[e],"click",function(){});a.onkeyup=null}}if(h){c.stoplistening(h,"click",function(){})}c.i=0;g.innerHTML="";if(g.parentNode){g.parentNode.removeChild(g)}},alert:function(i,h,d){if(typeof d!=="object"){d=false}var j=c.newdialog();c.build(i,{type:"alert",callback:h,params:d,newid:j})},signal:function(j,h,d){if(typeof d!=="object"){d=false}var i=5000;if(d.duration!=="undefined"){i=d.duration}var k=c.newdialog();c.build(j,{type:"signal",callback:h,timeout:i,params:d,newid:k})},confirm:function(i,h,d){if(typeof d!=="object"){d=false}var j=c.newdialog();c.build(i,{type:"confirm",callback:h,params:d,newid:j})},quiz:function(i,h,d){if(typeof d!=="object"){d=false}var j=c.newdialog();c.build(i,{type:"quiz",callback:h,params:d,newid:j})},prompt:function(i,h,d){if(typeof d!=="object"){d=false}var j=c.newdialog();return c.build(i,{type:"prompt",callback:h,params:d,newid:j})},listen:function(i,h,d){if(i.addEventListener){return i.addEventListener(h,d,false)}if(i.attachEvent){return i.attachEvent("on"+h,d)}return false},stoplistening:function(i,h,d){if(i.removeEventListener){return i.removeEventListener(h,d,false)}if(i.detachEvent){return i.detachEvent("on"+h,d)}return false}};c.init=true;if(typeof module!="undefined"&&module.exports){module.exports=c}else{if(typeof define==="function"&&define.amd){define("smoke",[],function(){return c})}else{this.smoke=c}}})(window,document);